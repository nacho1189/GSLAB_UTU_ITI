<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registrar Usuario - SGLITI</title>
  <link rel="stylesheet" href="./CSS/estilos.css">
</head>
<body>
  <header>
    <form class="logo">
      <a href="index.html">
        <img src="./docs/imgs/logo.png" alt="Logo de laboratorio">
      </a>
    </form>
    <h1>SGLITI</h1>
  </header>
  
  <main>
    <div class="contenedor-formulario">
      <h1 id="titulo-usuario">Registrar un Usuario</h1>
      
      <form action="../controladores/UsuariosControlador.php" method="POST" id="formulario-usuario">
        <input type="hidden" name="accion" value="altaUsuario">
        
        <!-- Nombre -->
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" name="nombre" placeholder="Ingrese el nombre completo" required>
        
        <!-- Email -->
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" placeholder="ejemplo@correo.com">
        
        <!-- Rol -->
        <label for="rol">Rol:</label>
        <select name="rol" id="rol" required>
          <option value="1" selected>Estudiante</option>
          <option value="2">Asistente</option>
          <option value="3">Administrador</option>
          <option value="4">Docente</option>
        </select>
        
        <!-- Contraseña (solo para Asistente o Administrador) -->
        <div id="campo-password" style="display:none;">
          <label for="password">Contraseña:</label>
          <input type="password" id="password" name="password" placeholder="Ingrese una contraseña segura">
        </div>
        
        <!-- Cédula -->
        <label for="cedula">Cédula:</label>
        <input type="text" id="cedula" name="cedula" placeholder="Ingrese la cédula" required>
        
        <!-- Botones -->
        <div class="botones-container">
          <button type="submit" id="btn-registrar">Registrar Usuario</button>
          <a href="IndexAdmin.html" class="btn-volver">Volver</a>
        </div>
      </form>
    </div>
  </main>

  <script>
    // Mostrar u ocultar campo contraseña según rol seleccionado
    document.getElementById('rol').addEventListener('change', function() {
      const campoPassword = document.getElementById('campo-password');
      const passwordInput = document.getElementById('password');
      
      // Asistente (2) y Administrador (3) requieren contraseña
      if (this.value === "2" || this.value === "3") {
        campoPassword.style.display = "block";
        passwordInput.setAttribute("required", "true");
      } else {
        campoPassword.style.display = "none";
        passwordInput.removeAttribute("required");
        passwordInput.value = "";
      }
    });

    // Validación del formulario
    document.getElementById('formulario-usuario').addEventListener('submit', function(e) {
      const nombre = document.getElementById('nombre').value.trim();
      const cedula = document.getElementById('cedula').value.trim();
      const rol = document.getElementById('rol').value;
      const password = document.getElementById('password').value;

      if (!nombre || !cedula) {
        e.preventDefault();
        alert('Por favor complete el nombre y la cédula');
        return false;
      }

      if ((rol === "2" || rol === "4") && !password) {
        e.preventDefault();
        alert('La contraseña es requerida para este rol');
        return false;
      }
    });

    // Mostrar mensajes de error/éxito
    window.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      
      if (urlParams.has('error')) {
        const error = urlParams.get('error');
        if (error === 'registro_failed') {
          alert('Error al registrar usuario. Verifique que la cédula no esté ya registrada.');
        }
      }
      
      if (urlParams.has('success')) {
        const success = urlParams.get('success');
        if (success === 'usuario_registrado') {
          alert('Usuario registrado exitosamente.');
        }
      }
    });
  </script>
</body>
</html>